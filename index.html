<!DOCTYPE html>
<html>
<meta charset="utf-8">

<div id="scatterplot"></div>
<div id="yearly-chart"></div>
<style>

text {
  font: 12px sans-serif;
}

svg .axis path, .axis line {
  fill: none;
  stroke: gray;
  shape-rendering: crispEdges;
}

svg .axis text {
  font-family: sans-serif;
  font-size: 11px;
  color: gray;
}

svg .line {
  fill: none;
  stroke: steelblue;
  stroke-width: 4px;
}

svg .line-points {
	stroke: steelblue;
}

div {
	display: block;
}
</style>
<body>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>

<script type="text/javascript">

var svgWidth = 1000;
var svgHeight = 700;
var padding = 30;

var parseDate = d3.time.format("%d-%b-%y").parse;

var xScale = d3.time.scale()
	.range([padding, svgWidth - padding]);

var yScale = d3.scale.linear()
	.range([svgHeight - padding, padding]);

var scatterColorScale = d3.scale.linear()
	.domain([0, 10])
	.rangeRound([60, 160]);

var linePointsScale = d3.scale.linear()
	.domain([0, 0.5])
	.rangeRound([60, 140]);

var xAxis = d3.svg.axis()
	.scale(xScale)
	.orient("bottom")
	.ticks(16);

var yAxis = d3.svg.axis()
	.scale(yScale)
	.orient("left")
	.ticks(11);

var yMonthlyPercentAxis = d3.svg.axis()
	.scale(yScale)
	.orient("left")
	.ticks(6);

var percentLine = d3.svg.line()
	.interpolate("linear")
  .x(function(d) { return xScale(d.date); })
  .y(function(d) { return yScale(d.percent); });

var scatterplotSVG = d3.select("#scatterplot")
	.append("svg")
	.attr("width", svgWidth)
	.attr("height", svgHeight);

var yearlyChartSVG = d3.select("#yearly-chart")
	.append("svg")
	.attr("width", svgWidth)
	.attr("height", svgHeight);

/* var svg = d3.select("body")
	.append("svg")
	.attr("width", svgWidth)
	.attr("height", svgHeight);*/

d3.csv("/data/weekly_collabs.csv", function(data) {

	data.forEach(function(d) {
    d.date = parseDate(d.date);
  });

	//compute domain
  xScale.domain(d3.extent(data, function(d) { return d.date; }));
  yScale.domain(d3.extent(data, function(d) { return d.collabs}));

	//weekly collabs scatterplot
	scatterplotSVG.selectAll("circle")
		.data(data)
		.enter()
		.append("circle")
		.attr("cx", function(d) {
			return xScale(d.date);
		})
		.attr("cy", function(d) {
			return yScale(d.collabs);
		})
		.attr("r", 5)
		.attr("fill", function(d) {
			return "rgba(" + scatterColorScale(d.collabs) + ", 80, 180, 0.5)";
		});

	//monthly collabs line
	/* svg.selectAll("line")
		.data(data)
		.enter()
		.append("line")
		.attr("ax", 50)

		.attr("y" 100);*/

	scatterplotSVG.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(0," + (svgHeight - padding) + ")")
    .call(xAxis);

  scatterplotSVG.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(" + padding + ",0)")
    .call(yAxis);

   

  //line graph
  /* svg.append("path")
		.datum(data)
		.attr("class", "line")
		.attr("d", line);*/
});

d3.csv("/data/yearly_collabs.csv", function(data) {

	data.forEach(function(d) {
    d.date = parseDate(d.date);
  });

	xScale.domain(d3.extent(data, function(d) { return d.date; }));
  yScale.domain(d3.extent(data, function(d) { return d.percent}));

	yearlyChartSVG.append("path")
		.datum(data)
		.attr("class", "line")
		.attr("d", percentLine);

	yearlyChartSVG.selectAll("cricle")
  	.data(data)
  	.enter()
  	.append("circle")
  	.attr("cx", function(d) {
  		return xScale(d.date);
  	})
  	.attr("cy", function(d) {
  		return yScale(d.percent);
  	})
  	.attr("r", 8)
  	.attr("class", "line-points")
  	.attr("fill", function(d) {
			return "rgba(" + linePointsScale(d.percent) + ", 120, 160, 1.0)";
		});

  yearlyChartSVG.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(0," + (svgHeight - padding) + ")")
    .call(xAxis);

	yearlyChartSVG.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(" + padding + ",0)")
    .call(yMonthlyPercentAxis);

});

</script>

</body>
</html>